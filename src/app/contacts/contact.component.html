<div class="contact-form-container">
  <div class="form-header">
    <h2>{{ editMode ? 'Edit Contact' : 'Contact Entry Form' }}</h2>
    <button *ngIf="editMode" type="button" class="close-btn" (click)="cancel()">Ã—</button>
  </div>

  <form [formGroup]="form" (ngSubmit)="submit()" class="contact-form">
    <div class="grid-container">
      <label>
        First Name *:
        <input type="text" formControlName="firstname" />
        <div class="error" *ngIf="form.get('firstname')?.invalid && form.get('firstname')?.touched">
          First name is required
        </div>
      </label>
      <label>
        Last Name *:
        <input type="text" formControlName="lastname" />
        <div class="error" *ngIf="form.get('lastname')?.invalid && form.get('lastname')?.touched">
          Last name is required
        </div>
      </label>

      <label>
        Mobile Number *:
        <input type="tel" formControlName="mobilenumber" />
        <div class="error" *ngIf="form.get('mobilenumber')?.invalid && form.get('mobilenumber')?.touched">
          Valid mobile number is required
        </div>
      </label>

      <label>
        WhatsApp Number (Verification):
        <div class="mobile-input-container">
          <input type="tel" formControlName="whatsappnumber" placeholder="Same as mobile if empty" />
          <div class="wa-status-container">
            <button *ngIf="!isWhatsAppVerified && !isNotOnWhatsApp" type="button" class="verify-wa-btn"
              (click)="verificationSent ? noop() : verifyWhatsApp()"
              [disabled]="verifying || !form.get('whatsappnumber')?.value" [class.sent]="verificationSent">
              <span class="btn-icon" *ngIf="!verifying">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path
                    d="M12.031 6.172c-3.181 0-5.767 2.586-5.767 5.767 0 1.258.405 2.422 1.096 3.363l-1.122 3.326 3.425-1.1c.904.537 1.956.844 3.082.844 3.181 0 5.767-2.586 5.767-5.767 0-3.181-2.586-5.767-5.767-5.767zm3.504 8.216c-.147.414-.732.744-1.171.8-.396.05-.913.045-1.468-.152-2.316-.822-3.804-3.172-3.92-3.328-.116-.156-.944-1.253-.944-2.392 0-1.139.593-1.697.804-1.921.21-.224.461-.28.614-.28.153 0 .307 0 .442.008.145.006.337-.056.528.406.191.462.651 1.587.708 1.701.056.114.094.246.019.396-.075.15-.113.243-.226.376-.112.133-.236.297-.338.4-.113.111-.23.232-.1.455.13.223.578.952 1.241 1.541.856.762 1.577 1.002 1.801 1.114.224.111.355.093.488-.06.133-.153.562-.656.712-.88.151-.224.302-.187.509-.112.207.076 1.313.62 1.537.732.224.112.373.167.429.263.056.096.056.554-.091.968z" />
                </svg>
              </span>
              {{ verifying ? '...' : (verificationSent ? 'Verifying...' : 'Verify') }}
            </button>
            <span *ngIf="isWhatsAppVerified" class="wa-badge">
              <svg style="margin-right: 6px;" width="14" height="14" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              Verified
            </span>
            <span *ngIf="isNotOnWhatsApp" class="wa-badge error">
              <svg style="margin-right: 6px;" width="14" height="14" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
              </svg>
              Not on WA
            </span>
          </div>
        </div>
        <!-- Optional error for WA number pattern -->
        <div class="error" *ngIf="form.get('whatsappnumber')?.invalid && form.get('whatsappnumber')?.touched">
          Invalid format
        </div>
      </label>

      <label>
        Email:
        <input type="email" formControlName="email" />
        <div class="error" *ngIf="form.get('email')?.invalid && form.get('email')?.touched">
          Please enter a valid email format
        </div>
      </label>

      <label>
        Date of Birth:
        <input type="date" formControlName="dateofbirth" />
      </label>
      <label>
        Location *:
        <select formControlName="locationid">
          <option value="">--Select Location--</option>
          <option *ngFor="let loc of locations" [value]="loc.id">{{ loc.location }}</option>
        </select>
        <div class="error" *ngIf="form.get('locationid')?.invalid && form.get('locationid')?.touched">
          Location is required
        </div>
      </label>

      <label>
        PAN Number:
        <input type="text" formControlName="pannumber" placeholder="ABCDE1234F" />
      </label>
      <label>
        Aadhar Number:
        <input type="text" formControlName="aadharnumber" placeholder="1234 5678 9012" />
      </label>

      <label>
        PIN Code:
        <input type="text" formControlName="pincode" placeholder="123456" />
      </label>
      <label>
        Gender:
        <select formControlName="gender">
          <option value="">--Select Gender--</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
          <option value="Other">Other</option>
        </select>
      </label>

      <label>
        Marital Status:
        <select formControlName="materialstatus">
          <option value="">--Select Status--</option>
          <option value="Single">Single</option>
          <option value="Married">Married</option>
          <option value="Divorced">Divorced</option>
        </select>
      </label>
      <label>
        No. of Dependents:
        <input type="number" formControlName="noofdependent" min="0" />
      </label>

      <label>
        Reference Name:
        <input type="text" formControlName="referencename" />
      </label>
      <label>
        Product Name:
        <input type="text" formControlName="productname" />
        <input type="text" hidden="true" formControlName="status" />
        <input type="text" hidden="true" formControlName="organizationid" />
        <input type="text" hidden="true" formControlName="createdby" />
        <input type="text" hidden="true" formControlName="createdon" />
      </label>

      <label class="span-2">
        Present Address:
        <textarea formControlName="presentaddress" rows="3"></textarea>
      </label>
      <label class="span-2">
        Permanent Address:
        <textarea formControlName="permanentaddress" rows="3"></textarea>
      </label>
      <label class="span-2">
        Educational Qualification:
        <textarea formControlName="educationalqualification" rows="2"></textarea>
      </label>
      <label class="span-2">
        Remarks:
        <textarea formControlName="remarks" rows="3"></textarea>
      </label>
    </div>

    <div class="buttons">
      <button type="submit" [disabled]="form.invalid || saving">
        {{ saving ? 'Saving...' : (editMode ? 'Update Contact' : 'Add Contact') }}
      </button>
      <button type="button" class="secondary" (click)="cancel()">Cancel</button>
    </div>
  </form>
</div>